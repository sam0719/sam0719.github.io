<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>投資組合分析 - 月報</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
  <style>
    .bg-gradient {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      min-height: 100vh;
    }
    .content-wrapper {
      padding: 2rem 0;
    }
    .sidebar {
      width: 350px;
      max-height: calc(100vh - 150px);
      overflow-y: auto;
      border: 1px solid #ccc;
      background-color: #fff;
      padding: 20px;
    }
    .dynamic-button {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px 12px;
      font-size: 16px;
      text-align: left;
      transition: background-color 0.3s;
      border-radius: 5px;
      border: 2px solid #ccc;
    }
    .btn-produced {
      background-color: #d4edda !important;
      color: #155724;
      border-color: #c3e6cb !important;
    }
    .btn-not-produced {
      background-color: #f8d7da !important;
      color: #721c24;
      border-color: #f5c6cb !important;
    }
    #trendChart {
      width: 100%;
      height: 600px;
      background-color: #fff;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body class="bg-gradient">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="index.html">股票投資組合系統</a>
    <!-- <div class="collapse navbar-collapse justify-content-end">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="index.html">
            <i class="fas fa-arrow-left mr-2"></i>返回主頁
          </a>
        </li>
      </ul>
    </div> -->
  </nav>

  <!-- 載入 Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <div class="container-fluid" id="app">
    <div class="content-wrapper">
      <!-- Title 與下拉選單 -->
      <div class="text-center mt-4">
        <h1 class="display-4">投資組合分析 - 月報</h1>
      </div>
      <div class="text-center mb-1">
        <p class="lead">請選擇國家與測試期起始時間以生成滑動視窗</p>
      </div>
      <div class="text-center mb-4">
        <div class="form-inline justify-content-center">
          <label for="countrySelect" class="mr-2">選擇國家:</label>
          <select id="countrySelect" class="form-control mr-2" v-model="selectedCountry" @change="updateTestPeriodRange">
            <option v-for="country in countries" :key="country" :value="country">[[ country ]]</option>
          </select>
          <label for="yearSelect" class="mr-2">選擇年:</label>
          <select id="yearSelect" class="form-control mr-2" v-model="selectedYear">
            <option v-for="year in availableYears" :key="year" :value="year">[[ year ]]</option>
          </select>
          <label for="monthSelect" class="mr-2">選擇月:</label>
          <select id="monthSelect" class="form-control" v-model="selectedMonth">
            <option v-for="(m, index) in months" :key="index" :value="index">[[ m ]]</option>
          </select>
        </div>
      </div>

      <!-- 走勢圖與滑動視窗列表 -->
      <div class="row">
        <!-- 左側：滑動視窗列表 -->
        <div class="col-md-3">
          <div class="sidebar">
            <h5>滑動視窗列表</h5>
            <ul class="list-unstyled">
              <li v-for="(win, index) in slidingWindows" :key="index">
                <button @click="selectWindow(index)" class="dynamic-button"
                  :class="{'btn-produced': win.status==='已產生', 'btn-not-produced': win.status==='未產生'}">
                  [[ transformWindowName(win.name) ]] - 訓練期: [[ formatDate(win.trainStart) ]] ~ [[ formatDate(win.trainEnd) ]] ([[ win.status ]])
                </button>
              </li>
            </ul>
            <p v-if="!slidingWindows || slidingWindows.length === 0">請先選擇測試期起始時間。</p>
          </div>
        </div>
        <!-- 右側：走勢圖 -->
        <div class="col-md-9">
          <canvas id="trendChart"></canvas>
        </div>
      </div>

      <!-- 顯示選中滑動視窗詳細資訊（移到圖表下方） -->
      <div class="container mt-4" v-if="currentWindow !== null">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">滑動視窗：[[ transformWindowName(slidingWindows[currentWindow].name) ]]</h5>
            <p class="card-text">
              <strong>測試期:</strong> [[ formatDate(slidingWindows[currentWindow].testStart) ]] ~ [[ formatDate(slidingWindows[currentWindow].testEnd) ]]<br>
              <strong>訓練期:</strong> [[ formatDate(slidingWindows[currentWindow].trainStart) ]] ~ [[ formatDate(slidingWindows[currentWindow].trainEnd) ]]
            </p>
          </div>
        </div>
      </div>

      <!-- 圖表下方：投資組合結果 -->
      <div class="container mt-4">
        <div class="row">
          <!-- 投資組合評估結果 -->
          <div class="col-md-6">
            <h5>投資組合評估結果</h5>
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>趨勢值</th>
                    <th>風險</th>
                    <th>預期報酬率</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="perf in performanceData" :key="perf.id">
                    <td>[[ perf.trend_value ]]</td>
                    <td>[[ perf.risk ]]</td>
                    <td>[[ perf.expected_return ]]</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- 投資組合股票資訊 -->
          <div class="col-md-6">
            <h5>投資組合股票資訊</h5>
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>股票代號</th>
                    <th>策略分類</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="port in portfolioData" :key="port.id">
                    <td>[[ port.stock_code ]]</td>
                    <td>[[ port.category ]]</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- 載入 Vue、jQuery、Bootstrap 與 select2 -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    new Vue({
      el: '#app',
      delimiters: ['[[', ']]'],
      data: {
        startYear: 1970,
        availableYears: [],
        years: [],
        months: ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'],
        selectedYear: null,
        selectedMonth: new Date().getMonth(), // 0-indexed
        selectedCountry: null,
        countries: [],
        slidingWindows: [],
        currentWindow: null,
        chart: null,
        performanceData: [],
        portfolioData: [],
        trainingPeriod: "",
        fsConfig: null,
        portfolioConfig: null,
        windowConfigs: [
          { name: "Y2Y", mode: "symmetric", testLength: 12, trainLength: 12 },
          { name: "H2H", mode: "symmetric", testLength: 6, trainLength: 6 },
          { name: "Q2Q", mode: "symmetric", testLength: 3, trainLength: 3 },
          { name: "M2M", mode: "symmetric", testLength: 1, trainLength: 1 },
          { name: "Y2H", mode: "nonsymmetric", testLength: 6, trainLength: 12 },
          { name: "Y2Q", mode: "nonsymmetric", testLength: 3, trainLength: 12 },
          { name: "Y2M", mode: "nonsymmetric", testLength: 1, trainLength: 12 },
          { name: "H2Q", mode: "nonsymmetric", testLength: 3, trainLength: 6 },
          { name: "H2M", mode: "nonsymmetric", testLength: 1, trainLength: 6 },
          { name: "Q2M", mode: "nonsymmetric", testLength: 1, trainLength: 3 },
          { name: "H*", mode: "corresponding", testLength: 6 },
          { name: "Q*", mode: "corresponding", testLength: 3 },
          { name: "M*", mode: "corresponding", testLength: 1 }
        ]
      },
      computed: {
        testPeriodYears() {
          if (!this.slidingWindows.length) return [];
          const years = this.slidingWindows.map(win => win.testStart.getFullYear());
          const minYear = Math.min(...years);
          const maxYear = Math.max(...years);
          let arr = [];
          for (let y = minYear; y <= maxYear; y++) {
            arr.push(y);
          }
          this.availableYears = arr;
          return arr;
        }
      },
      created() {
        const currentYear = new Date().getFullYear();
        for (let y = this.startYear; y <= currentYear; y++) {
          this.years.push(y);
        }
        this.selectedYear = currentYear;

        // 載入 FS 資料的索引設定檔，從中取得國家列表與可用年份範圍
        fetch('FS_data/config.json')
          .then(response => response.json())
          .then(cfg => {
            this.fsConfig = cfg;
            const countries = Array.from(new Set(cfg.files.map(f => f.country)));
            this.countries = countries;
            if (countries.length > 0) {
              this.selectedCountry = countries[0];
            }
            this.updateTestPeriodRange();
          })
          .catch(err => {
            console.error('Failed to load FS config:', err);
          });

        // 載入投資組合股票資訊的索引設定檔
        fetch('Portfolio_data/config.json')
          .then(response => response.json())
          .then(cfg => {
            this.portfolioConfig = cfg;
          })
          .catch(err => {
            console.error('Failed to load Portfolio config:', err);
          });
      },
      watch: {
        selectedYear() {
          this.updateSlidingWindows();
        },
        selectedMonth() {
          this.updateSlidingWindows();
        },
        availableYears(newYears) {
          if (!newYears.includes(this.selectedYear)) {
            this.selectedYear = newYears[0];
          }
          this.updateSlidingWindows();
        }
      },
      methods: {
        updateTestPeriodRange() {
          if (!this.fsConfig || !this.selectedCountry) return;

          // 根據 FS 設定檔中該國家的 Test 資料，推算可用的測試年份範圍
          const files = this.fsConfig.files.filter(f => f.country === this.selectedCountry && f.data_type === 'Test');
          if (!files.length) {
            console.warn('No FS Test data found for country:', this.selectedCountry);
            return;
          }

          const years = files.map(f => {
            const m = f.cleaned_filename.match(/\d{4}/);
            return m ? parseInt(m[0]) : null;
          }).filter(y => y);

          if (!years.length) return;

          const minYear = Math.min(...years);
          const maxYear = Math.max(...years);
          let arr = [];
          for (let y = minYear; y <= maxYear; y++) {
            arr.push(y);
          }
          this.availableYears = arr;
          if (!arr.includes(this.selectedYear)) {
            this.selectedYear = arr[0];
          }
          this.updateSlidingWindows();
        },
        isAlignedForTest(date, testLength) {
          const m = date.getMonth();
          if (testLength === 1) return true;
          if (testLength === 3) return [0, 3, 6, 9].includes(m);
          if (testLength === 6) return [0, 6].includes(m);
          if (testLength === 12) return m === 0;
          return true;
        },
        adjustTestStart(date, testLength) {
          if (testLength === 1) {
            return new Date(date.getFullYear(), date.getMonth(), 1);
          } else if (testLength === 3) {
            const month = date.getMonth();
            const quarterStartMonth = Math.floor(month / 3) * 3;
            return new Date(date.getFullYear(), quarterStartMonth, 1);
          } else if (testLength === 6) {
            const month = date.getMonth();
            return (month < 6) ? new Date(date.getFullYear(), 0, 1) : new Date(date.getFullYear(), 6, 1);
          } else if (testLength === 12) {
            return new Date(date.getFullYear(), 0, 1);
          } else {
            return date;
          }
        },
        updateSlidingWindows() {
          const baseDate = new Date(this.selectedYear, this.selectedMonth, 1);
          this.slidingWindows = this.windowConfigs.map(config => {
            const testStart = this.adjustTestStart(baseDate, config.testLength);
            let testEnd = this.addMonths(testStart, config.testLength);
            testEnd.setDate(testEnd.getDate() - 1);
            let trainStart, trainEnd;
            if (config.mode === "symmetric" || config.mode === "nonsymmetric") {
              trainStart = this.addMonths(testStart, -config.trainLength);
              trainEnd = this.addMonths(trainStart, config.trainLength);
              trainEnd.setDate(trainEnd.getDate() - 1);
            } else if (config.mode === "corresponding") {
              trainStart = new Date(testStart.getFullYear() - 1, testStart.getMonth(), testStart.getDate());
              trainEnd = this.addMonths(trainStart, config.testLength);
              trainEnd.setDate(trainEnd.getDate() - 1);
            }
            let status = "未產生";
            if (this.fsConfig) {
              const datasetName = this.transformWindowName(config.name);
              const trainingPeriod = this.computeTrainingPeriodForConfig(config.name);
              const hasFsTrain = trainingPeriod && this.fsConfig.files.some(f =>
                f.country === this.selectedCountry &&
                f.dataset_name === datasetName &&
                f.cleaned_filename === trainingPeriod &&
                f.data_type === 'Train'
              );
              status = hasFsTrain ? "已產生" : "未產生";
            }
            return {
              name: config.name,
              testStart: new Date(testStart),
              testEnd: new Date(testEnd),
              trainStart: trainStart,
              trainEnd: trainEnd,
              status: status
            };
          });
          if (this.slidingWindows.length > 0) {
            this.currentWindow = 0;
          } else {
            this.currentWindow = null;
          }
        },
        // 根據 window 名稱、國家、年、月計算對應的 trainingPeriod（不依賴 currentWindow）
        computeTrainingPeriodForConfig(configName) {
          if (configName === "Y2Y") {
            return (this.selectedYear - 1).toString();
          } else if (configName === "M2M") {
            if ((this.selectedMonth + 1) === 1) {
              return `${this.selectedYear - 1}_12`;
            } else {
              return `${this.selectedYear}_${String(this.selectedMonth).padStart(2, '0')}`;
            }
          } else if (configName === "Y2M") {
            if ((this.selectedMonth + 1) === 1) {
              return (this.selectedYear - 1).toString();
            } else {
              return `${this.selectedYear - 1}_${String(this.selectedMonth + 1).padStart(2, '0')}~${this.selectedYear}_${String(this.selectedMonth).padStart(2, '0')}`;
            }
          } else if (configName === "H2H") {
            if ((this.selectedMonth + 1) <= 6) {
              return `${this.selectedYear - 1}_Q3-Q4`;
            } else {
              return `${this.selectedYear}_Q1-Q2`;
            }
          } else if (configName === "Y2H") {
            if ((this.selectedMonth + 1) <= 6) {
              return (this.selectedYear - 1).toString();
            } else {
              return `${this.selectedYear - 1}_Q3~${this.selectedYear}_Q2`;
            }
          } else if (configName === "Y2Q") {
            const quarter = Math.floor(this.selectedMonth / 3) + 1;
            if (quarter === 1) {
              return (this.selectedYear - 1).toString();
            } else if (quarter === 2) {
              return `${this.selectedYear - 1}_Q2~${this.selectedYear}_Q1`;
            } else if (quarter === 3) {
              return `${this.selectedYear - 1}_Q3~${this.selectedYear}_Q2`;
            } else if (quarter === 4) {
              return `${this.selectedYear - 1}_Q4~${this.selectedYear}_Q3`;
            }
          } else if (configName === "Q2Q") {
            const quarter = Math.floor(this.selectedMonth / 3) + 1;
            if (quarter === 1) {
              return `${this.selectedYear - 1}_Q4`;
            } else {
              return `${this.selectedYear}_Q${quarter - 1}`;
            }
          } else if (configName === "H2Q") {
            const quarter = Math.floor(this.selectedMonth / 3) + 1;
            if (quarter === 1) {
              return `${this.selectedYear - 1}_Q3-Q4`;
            } else if (quarter === 2) {
              return `${this.selectedYear - 1}_Q4~${this.selectedYear}_Q1`;
            } else if (quarter === 3) {
              return `${this.selectedYear}_Q1-Q2`;
            } else if (quarter === 4) {
              return `${this.selectedYear}_Q2-Q3`;
            }
          } else if (configName === "H2M") {
            if ((this.selectedMonth + 1) <= 6) {
              if ((this.selectedMonth + 1) === 1) {
                return `${this.selectedYear - 1}_07~${this.selectedYear - 1}_12`;
              } else {
                return `${this.selectedYear - 1}_${String(this.selectedMonth + 1 + 6).padStart(2, '0')}~${this.selectedYear}_${String(this.selectedMonth).padStart(2, '0')}`;
              }
            } else {
              return `${this.selectedYear}_${String(this.selectedMonth + 1 - 6).padStart(2, '0')}~${this.selectedYear}_${String(this.selectedMonth).padStart(2, '0')}`;
            }
          } else if (configName === "Q2M") {
            if ((this.selectedMonth + 1) <= 3) {
              if ((this.selectedMonth + 1) === 1) {
                return `${this.selectedYear - 1}_10~${this.selectedYear - 1}_12`;
              } else {
                return `${this.selectedYear - 1}_${String(this.selectedMonth + 1 + 9).padStart(2, '0')}~${this.selectedYear}_${String(this.selectedMonth).padStart(2, '0')}`;
              }
            } else {
              return `${this.selectedYear}_${String(this.selectedMonth + 1 - 3).padStart(2, '0')}~${this.selectedYear}_${String(this.selectedMonth).padStart(2, '0')}`;
            }
          } else if (configName === "M*") {
            return `${this.selectedYear - 1}_${String(this.selectedMonth + 1).padStart(2, '0')}`;
          } else if (configName === "H*") {
            if ((this.selectedMonth + 1) <= 6) {
              return `${this.selectedYear - 1}_Q1-Q2`;
            } else {
              return `${this.selectedYear - 1}_Q3-Q4`;
            }
          } else if (configName === "Q*") {
            const quarter = Math.floor(this.selectedMonth / 3) + 1;
            return `${this.selectedYear - 1}_Q${quarter}`;
          }
          return "";
        },
        // 根據選定的滑動視窗及國家、年、月計算目前選中 window 的 trainingPeriod
        computeTrainingPeriod() {
          if (this.currentWindow === null) return "";
          const windowData = this.slidingWindows[this.currentWindow];
          return this.computeTrainingPeriodForConfig(windowData.name);
        },
        loadAllData() {
          this.trainingPeriod = this.computeTrainingPeriod();
          console.log("Computed trainingPeriod:", this.trainingPeriod);
          this.loadTrendChart();
          this.loadPerformanceData();
          this.loadPortfolioData();
        },
        loadTrendChart() {
          if (!this.fsConfig || this.currentWindow === null) return;

          const entry = this.getFsEntry();
          if (!entry) {
            console.error('No matching FS CSV found for parameters');
            return;
          }

          const csvPath = `FS_data/${entry.file}`;

          fetch(csvPath)
            .then(response => response.text())
            .then(text => {
              const trend = this.parseFSTrendFromCsv(text);
              console.log('Trend data loaded from CSV:', entry.file, trend.length);
              this.renderChart(trend);
            })
            .catch(err => {
              console.error('Failed to load FS CSV:', csvPath, err);
            });
        },
        loadPerformanceData() {
          if (!this.fsConfig || this.currentWindow === null) {
            this.performanceData = [];
            return;
          }

          const entry = this.getFsEntry();
          if (!entry) {
            this.performanceData = [];
            return;
          }

          const csvPath = `FS_data/${entry.file}`;

          fetch(csvPath)
            .then(response => response.text())
            .then(text => {
              const perf = this.parsePerformanceFromCsv(text);
              if (perf) {
                this.performanceData = [{
                  id: `${entry.country}_${entry.dataset_name}_${entry.cleaned_filename}_${entry.data_type}`,
                  trend_value: perf.trend_value,
                  risk: perf.risk,
                  expected_return: perf.expected_return
                }];
              } else {
                this.performanceData = [];
              }
            })
            .catch(err => {
              console.error('Failed to load FS CSV for performance:', csvPath, err);
              this.performanceData = [];
            });
        },
        loadPortfolioData() {
          if (!this.portfolioConfig || this.currentWindow === null) {
            this.portfolioData = [];
            return;
          }

          const windowData = this.slidingWindows[this.currentWindow];
          const windowName = windowData.name;
          const datasetName = this.transformWindowName(windowName); // 例如 H* -> H#

          const entry = this.portfolioConfig.files.find(f =>
            f.country === this.selectedCountry &&
            f.dataset_name === datasetName &&
            f.cleaned_filename === this.trainingPeriod &&
            f.data_type === 'Train'
          );

          if (!entry) {
            console.warn('No matching Portfolio CSV found for parameters');
            this.portfolioData = [];
            return;
          }

          const csvPath = `Portfolio_data/${entry.file}`;

          fetch(csvPath)
            .then(response => response.text())
            .then(text => {
              this.portfolioData = this.parsePortfolioFromCsv(text);
            })
            .catch(err => {
              console.error('Failed to load Portfolio CSV:', csvPath, err);
              this.portfolioData = [];
            });
        },
        selectWindow(index) {
          this.currentWindow = index;
          this.trainingPeriod = this.computeTrainingPeriod();
          this.loadAllData();
        },
        addMonths(date, months) {
          const d = new Date(date);
          d.setMonth(d.getMonth() + months);
          return d;
        },
        formatDate(date) {
          if (!date) return "";
          const yyyy = date.getFullYear();
          const mm = (date.getMonth() + 1).toString().padStart(2, "0");
          const dd = date.getDate().toString().padStart(2, "0");
          return `${yyyy}/${mm}/${dd}`;
        },
        transformWindowName(name) {
          return name.replace('*', '#');
        },
        getFsEntry() {
          if (!this.fsConfig || this.currentWindow === null) return null;
          const windowData = this.slidingWindows[this.currentWindow];
          const windowName = windowData.name;
          const datasetName = this.transformWindowName(windowName);
          return this.fsConfig.files.find(f =>
            f.country === this.selectedCountry &&
            f.dataset_name === datasetName &&
            f.cleaned_filename === this.trainingPeriod &&
            f.data_type === 'Train'
          ) || null;
        },
        parseFSTrendFromCsv(csvText) {
          const lines = csvText.trim().split(/\r?\n/);
          if (lines.length <= 1) return [];
          const header = lines[0].split(',');
          const fsIndex = header.indexOf('total_fs');
          if (fsIndex === -1) return [];

          const trend = [];
          for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            const cols = line.split(',');
            const v = parseFloat(cols[fsIndex]);
            if (!isNaN(v)) trend.push(v);
          }
          return trend;
        },
        parsePerformanceFromCsv(csvText) {
          const lines = csvText.trim().split(/\r?\n/);
          if (lines.length <= 1) return null;
          const header = lines[0].split(',');
          const trendIdx = header.indexOf('trend_value');
          const riskIdx = header.indexOf('risk');
          const retIdx = header.indexOf('expected_return');
          if (trendIdx === -1 || riskIdx === -1 || retIdx === -1) return null;

          const first = lines[1].split(',');
          return {
            trend_value: parseFloat(first[trendIdx]),
            risk: parseFloat(first[riskIdx]),
            expected_return: parseFloat(first[retIdx])
          };
        },
        parsePortfolioFromCsv(csvText) {
          const lines = csvText.trim().split(/\r?\n/);
          if (lines.length <= 1) return [];
          const header = lines[0].split(',');
          const codeIdx = header.indexOf('stock_code');
          const catIdx = header.indexOf('category');
          if (codeIdx === -1 || catIdx === -1) return [];

          const result = [];
          for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            const cols = line.split(',');
            const stock_code = cols[codeIdx];
            const category = cols[catIdx];
            result.push({
              id: `${stock_code}_${category}_${i}`,
              stock_code,
              category
            });
          }
          return result;
        },
        renderChart(trendData) {
          const labels = trendData.map((_, i) => i + 1);
          if (this.chart) {
            this.chart.data.labels = labels;
            this.chart.data.datasets[0].data = trendData;
            this.chart.update();
          } else {
            const ctx = document.getElementById('trendChart').getContext('2d');
            this.chart = new Chart(ctx, {
              type: 'line',
              data: {
                labels: labels,
                datasets: [{
                  label: '訓練期走勢',
                  data: trendData,
                  borderColor: 'rgba(75, 192, 192, 1)',
                  backgroundColor: 'rgba(75, 192, 192, 0.2)',
                  fill: false,
                  tension: 0.1
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  x: { title: { display: true, text: '天數' } },
                  y: { title: { display: true, text: '走勢值' } }
                }
              }
            });
          }
        }
      }
    });
  </script>
</body>
</html>
